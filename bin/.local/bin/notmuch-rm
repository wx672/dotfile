#!/bin/bash

command -v notmuch &>/dev/null || { echo "Missing notmuch. Quit..."; exit 1; }

TMP="$(mktemp)"

cleanup(){
	/bin/rm -f "$TMP"
}

trap cleanup INT EXIT TERM

remove(){
	local PTN="${1:-tag:unread}"
	notmuch search "$PTN" | tee $TMP
	[[ -s "$TMP" ]] || { echo no matching mail found.; exit; }
	printf "\n\tMark these emails as deleted? [y/N]: "
	read YN
	case $YN in
		[yY]|[yY][eE][sS])
			notmuch tag +deleted -inbox -unread "$PTN"
			notmuch new
			;;
		*)
			exit
	esac
}

case "$1" in
	"-h"|"--help"|"help")
		cat <<EOF
Example usage: 
		notmuch rm tag:helloworld
		notmuch rm date:20071231..2008
		notmuch rm from:/someone/
		notmuch rm [-h | --help | help]		 
EOF
		exit 0
		;;
	*) remove "$1"		
esac


